<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO AVANZADO -->
    <title>Guía y Examen Auxiliar de Farmacia Chile 2026 | Auxiliar Pro</title>
    <meta name="description" content="Guía completa para obtener la certificación de Auxiliar de Farmacia en Chile. Requisitos SEREMI, Decreto 466, cálculo de dosis y simulador de examen gratuito.">
    <meta name="keywords" content="auxiliar de farmacia, seremi salud, decreto 466, as digital, examen competencia farmacia, curso farmacia chile">
    <meta name="author" content="Marcelo - Auxiliar Trainee">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'farmacia-green': '#00C853',
                        'farmacia-dark': '#0d1b2a',
                        'metal-bronze': '#cd7f32',
                        'metal-silver': '#9e9e9e',
                        'metal-gold': '#ffd700',
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], heading: ['Roboto', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .locked-level { filter: grayscale(100%); opacity: 0.6; pointer-events: none; }
        .medal-shine { position: relative; overflow: hidden; }
        .medal-shine::after { content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%); transform: skewX(-25deg); animation: shine 3s infinite; }
        @keyframes shine { 100% { left: 200%; } }
        .library-unlocked { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        
        /* Estilos para Artículos del Blog */
        .prose h2 { font-size: 1.4rem; font-weight: 800; color: #111827; margin-top: 1.5em; margin-bottom: 0.5em; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.3em; }
        .prose h3 { font-size: 1.2rem; font-weight: 700; color: #0d1b2a; margin-top: 1.2em; margin-bottom: 0.5em; }
        .prose p { margin-bottom: 1em; line-height: 1.7; color: #4B5563; text-align: justify; }
        .prose ul, .prose ol { padding-left: 1.2em; margin-bottom: 1em; }
        .prose ul { list-style-type: disc; }
        .prose ol { list-style-type: decimal; }
        .prose li { margin-bottom: 0.5em; color: #4B5563; }
        .prose strong { color: #111827; font-weight: 700; }
        .prose a { color: #00C853; text-decoration: underline; cursor: pointer; font-weight: 600; }
        .prose a:hover { color: #00963f; }
        .prose .highlight { background-color: #ecfdf5; padding: 2px 5px; border-radius: 4px; color: #065f46; font-weight: 600; }
    </style>
</head>

<body class="bg-gray-100 text-gray-800 antialiased min-h-screen flex flex-col items-center justify-center">

    <!-- APP CONTAINER -->
    <div class="w-full max-w-md bg-white h-screen md:h-[90vh] md:rounded-3xl md:shadow-2xl overflow-hidden flex flex-col relative">

        <!-- VISTA 1: LANDING -->
        <div id="view-landing" class="flex-1 flex flex-col fade-in overflow-y-auto relative z-10">
            <header class="w-full py-4 px-6 flex justify-between items-center border-b border-gray-100 sticky top-0 bg-white/95 backdrop-blur-sm z-10">
                <div class="flex items-center gap-2">
                    <div class="bg-farmacia-green text-white p-1.5 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 6v12m-6-6h12"/></svg></div>
                    <span class="font-heading font-bold text-xl tracking-tight text-gray-900">Auxiliar<span class="text-farmacia-green">Pro</span></span>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="navToBlog()" class="text-xs font-bold text-gray-500 hover:text-farmacia-green uppercase tracking-wide">Guías</button>
                    <button onclick="checkAuthAndStart()" class="bg-farmacia-green hover:bg-green-600 text-white font-semibold py-1.5 px-4 rounded-full transition-all shadow-md text-xs">Entrar</button>
                </div>
            </header>

            <main class="flex-1 flex flex-col items-center text-center px-6 mt-12 pb-10">
                <div class="inline-flex items-center gap-2 bg-green-100 border border-green-200 text-green-800 text-xs font-bold px-3 py-1 rounded-full mb-6 uppercase tracking-wide">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> Certificación 2026
                </div>

                <h1 class="font-heading text-4xl font-extrabold text-gray-900 leading-tight mb-4">Prepárate para tu examen de <br><span class="text-farmacia-green">Auxiliar de Farmacia</span></h1>
                
                <p class="text-gray-500 text-lg mb-10 leading-relaxed max-w-xs">
                    Plataforma de estudio independiente. Practica, aprueba niveles y certifícate.
                </p>

                <div class="w-full space-y-4 mb-12">
                    <button onclick="checkAuthAndStart()" class="w-full group bg-farmacia-dark hover:bg-slate-900 text-white text-lg font-semibold py-4 px-8 rounded-lg shadow-xl hover:shadow-2xl transition-all flex items-center justify-center gap-3 cursor-pointer transform hover:-translate-y-1">
                        Comenzar Ahora 
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:translate-x-1 transition-transform"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                    </button>
                    
                    <button onclick="navToBlog()" class="w-full bg-white border border-gray-200 hover:border-farmacia-green text-gray-600 hover:text-farmacia-green font-bold py-3 px-8 rounded-lg transition-all flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                        Leer Guías y Artículos
                    </button>
                </div>

                <!-- Mensaje Personal -->
                <div class="bg-gray-50 rounded-2xl p-6 mb-10 text-left border border-gray-200 relative overflow-hidden">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-700 font-bold text-xl">M</div>
                        <div>
                            <h3 class="font-bold text-gray-900 text-sm">De un colega para ti</h3>
                            <p class="text-xs text-gray-500">Marcelo, Auxiliar Trainee</p>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 leading-relaxed relative z-10 italic">
                        "Esta web es mi cuaderno de estudio. Aquí encontrarás lo que estoy aprendiendo para el examen de 2026. ¡Vamos por ese logro juntos!"
                    </p>
                </div>

                <!-- SECCIÓN PREGUNTAS FRECUENTES -->
                <div class="w-full mb-12 text-left">
                    <h3 class="text-center text-xl font-bold text-gray-800 mb-6">Preguntas Frecuentes</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                            <h4 class="font-bold text-farmacia-dark text-sm mb-2">¿Qué requisitos necesito?</h4>
                            <p class="text-xs text-gray-600">Licencia de Enseñanza Media y acreditar 1 año de experiencia laboral en farmacia (o curso aprobado).</p>
                        </div>
                        
                        <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                            <h4 class="font-bold text-farmacia-dark text-sm mb-2">¿Cómo me inscribo al examen?</h4>
                            <p class="text-xs text-gray-600">Todo el trámite es online en <a href="https://asdigital.minsal.cl" target="_blank" class="text-farmacia-green underline">asdigital.minsal.cl</a> usando tu Clave Única.</p>
                        </div>

                        <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm">
                            <h4 class="font-bold text-farmacia-dark text-sm mb-2">¿El certificado vence?</h4>
                            <p class="text-xs text-gray-600">No, la resolución sanitaria es indefinida, salvo que cometas faltas graves al Código Sanitario.</p>
                        </div>
                    </div>
                </div>

                <footer class="text-center border-t border-gray-200 pt-8 pb-4 w-full">
                    <p class="text-xs text-gray-400 mb-4">© 2025 AuxiliarPro. Hecho con ❤️ en Chile.</p>
                    <div class="flex justify-center gap-4 text-[10px] text-gray-500 uppercase font-semibold tracking-wide mb-6">
                        <span onclick="openLegal('terms')" class="hover:text-farmacia-green transition-colors cursor-pointer">Términos</span>
                        <span onclick="openLegal('privacy')" class="hover:text-farmacia-green transition-colors cursor-pointer">Privacidad</span>
                        <span onclick="openLegal('disclaimer')" class="hover:text-farmacia-green transition-colors cursor-pointer">Descargo</span>
                    </div>
                </footer>
            </main>
        </div>

        <!-- VISTA 2: BLOG (LISTADO) -->
        <div id="view-blog" class="hidden flex-1 flex flex-col bg-white h-full overflow-hidden relative z-10">
            <header class="bg-white shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-10 border-b border-gray-100">
                <div class="flex items-center gap-3">
                    <button onclick="navToLanding()" class="text-gray-500 hover:text-farmacia-dark p-1 rounded-md hover:bg-gray-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    </button>
                    <span class="font-heading font-bold text-lg text-gray-900">Centro de Recursos</span>
                </div>
            </header>
            <main class="flex-1 p-6 overflow-y-auto bg-gray-50" id="blog-list-container">
                <!-- Se llena dinámicamente con JS -->
            </main>
        </div>

        <!-- VISTA 3: ARTÍCULO (LECTURA) -->
        <div id="view-article" class="hidden flex-1 flex flex-col bg-white h-full overflow-hidden relative z-20">
             <header class="bg-white shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-10 border-b border-gray-100">
                <button onclick="navToBlog()" class="flex items-center gap-2 text-sm text-gray-600 hover:text-farmacia-dark font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    Volver al listado
                </button>
                <span class="text-xs font-bold text-farmacia-green uppercase tracking-wider bg-green-50 px-2 py-1 rounded">Blog</span>
            </header>
            <main class="flex-1 p-6 overflow-y-auto prose max-w-none" id="article-content-container"></main>
        </div>

        <!-- VISTA 4: DASHBOARD -->
        <div id="view-dashboard" class="hidden flex-1 flex flex-col bg-slate-50 h-full overflow-hidden relative z-10">
            <header class="bg-white shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-10">
                <div class="flex flex-col">
                    <span class="font-heading font-bold text-gray-700">Panel de Estudio</span>
                    <span class="text-xs text-gray-400" id="header-user-welcome">Hola, Colega</span>
                </div>
                <button onclick="logout()" class="text-sm text-gray-500 hover:text-farmacia-dark font-medium flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg> Salir
                </button>
            </header>
            <main class="flex-1 p-6 w-full pb-20 overflow-y-auto">
                <div class="bg-white rounded-2xl p-6 shadow-md border-t-4 border-farmacia-green mb-8 text-center relative overflow-hidden">
                    <p class="text-gray-500 text-sm font-semibold uppercase tracking-wider mb-2">Tu Camino al Éxito</p>
                    <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2"><div class="bg-farmacia-green h-2.5 rounded-full transition-all duration-1000" id="progress-bar" style="width: 5%"></div></div>
                    <div class="flex justify-between text-xs text-gray-400 font-medium">
                        <span id="header-medal-status">Rango: Novato</span>
                        <span>Nivel</span>
                    </div>
                </div>
                <div class="space-y-4" id="levels-container"></div>
                <div id="rewards-section" class="mt-8 pt-8 border-t border-gray-200 mb-8 space-y-4"></div>
            </main>
        </div>

        <!-- MODALES -->
        <div id="auth-modal" class="absolute inset-0 z-50 bg-black/50 backdrop-blur-sm hidden items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-sm shadow-2xl overflow-hidden p-6 animate-bounce-in">
                <div class="text-center mb-6">
                    <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-farmacia-green"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></div>
                    <h2 class="text-2xl font-bold text-gray-900">Bienvenido Colega</h2>
                    <p class="text-sm text-gray-500">Ingresa tu nombre para personalizar tu experiencia.</p>
                </div>
                <form onsubmit="handleRegister(event)" class="space-y-4">
                    <div><input type="text" id="input-name" placeholder="Tu Nombre o Pseudónimo" class="w-full p-3 rounded-lg border border-gray-300 focus:border-farmacia-green focus:ring-1 outline-none text-center font-medium" required></div>
                    <button type="submit" class="w-full bg-farmacia-dark hover:bg-slate-900 text-white font-bold py-3 rounded-lg transition-colors">Comenzar Entrenamiento</button>
                </form>
            </div>
        </div>

        <div id="legal-modal" class="absolute inset-0 z-50 bg-black/50 backdrop-blur-sm hidden items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-sm shadow-2xl overflow-hidden p-6 relative max-h-[80vh] flex flex-col">
                <button onclick="document.getElementById('legal-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                <h2 id="legal-title" class="text-xl font-bold text-gray-900 mb-4 shrink-0">Términos Legales</h2>
                <div id="legal-content" class="overflow-y-auto text-sm text-gray-600 space-y-3 pr-2 text-justify"></div>
                <button onclick="document.getElementById('legal-modal').classList.add('hidden')" class="mt-4 w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg transition-colors shrink-0">Entendido</button>
            </div>
        </div>

        <div id="forum-modal" class="absolute inset-0 z-50 bg-black/50 backdrop-blur-sm hidden items-center justify-center p-4">
            <div class="bg-white rounded-2xl w-full max-w-sm shadow-2xl overflow-hidden p-6 relative">
                <button onclick="document.getElementById('forum-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                <div class="text-center mb-6"><div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-purple-600"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div><h2 class="text-xl font-bold text-gray-900">Comunidad</h2><p class="text-sm text-gray-500">Únete a los grupos.</p></div>
                <div class="space-y-3">
                    <a href="https://chat.whatsapp.com/IPvHmnNGWYmH61FrdV56g1" target="_blank" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors flex justify-center items-center gap-2"><svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> WhatsApp</a>
                    <a href="https://www.facebook.com/share/g/1KFQPWG1YN/" target="_blank" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition-colors flex justify-center items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg> Facebook</a>
                </div>
            </div>
        </div>

        <div id="quiz-modal" class="absolute inset-0 z-50 bg-white md:rounded-3xl hidden flex-col">
            <div class="bg-farmacia-dark p-6 text-white flex justify-between items-center shrink-0"><div><h3 class="font-bold text-xl" id="quiz-title">Evaluación</h3><p class="text-blue-200 text-sm" id="quiz-subtitle">Modo Examen</p></div><button onclick="closeQuiz()" class="text-white/70 hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>
            <div class="flex-1 overflow-y-auto p-6"><div id="quiz-content-active"><div id="quiz-question-container"></div></div><div id="quiz-content-result" class="hidden text-center mt-10"><div id="result-icon" class="mb-4 flex justify-center"></div><h2 id="result-title" class="text-2xl font-bold mb-2 text-gray-900"></h2><p id="result-message" class="text-gray-600 mb-6"></p><div id="weakness-feedback" class="hidden bg-orange-50 border border-orange-100 p-3 rounded-lg text-xs text-orange-800 mb-4 text-left"></div><div class="bg-gray-50 rounded-lg p-4 mb-6 border border-gray-200"><p class="text-sm text-gray-500 uppercase font-bold">Tu Puntaje</p><p class="text-3xl font-bold text-farmacia-dark" id="result-score">0/0</p></div><div class="flex flex-col gap-3"><button id="btn-review" onclick="startReviewMode()" class="w-full border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 font-bold py-3 rounded-lg">Ver Respuestas Correctas</button><button id="btn-retry" onclick="retryLevel()" class="w-full bg-farmacia-green hover:bg-green-600 text-white font-bold py-3 rounded-lg">Intentar de Nuevo</button><button onclick="closeQuiz()" class="text-sm text-gray-400 mt-2 hover:text-gray-600 underline">Salir al Panel</button></div></div></div>
            <div id="quiz-footer" class="p-4 border-t border-gray-100 bg-gray-50 shrink-0 flex justify-between items-center"><span class="text-xs text-gray-500 font-bold">PREGUNTA <span id="current-q-num">1</span>/<span id="total-q-num">3</span></span><button id="next-btn" onclick="nextQuestion()" class="bg-farmacia-dark hover:bg-slate-700 text-white px-6 py-2 rounded-lg font-medium">Siguiente</button></div>
        </div>
    </div>

    <!-- LÓGICA PRINCIPAL -->
    <script>
        // 1. BLOG DATA (CONTENIDO REAL)
        const BLOG_POSTS = [
            { 
                id: 'guia-maestra', 
                title: "Guía Completa para ser Auxiliar de Farmacia", 
                excerpt: "Todo lo que necesitas saber para certificarte en 2026: requisitos, examen y trámites.", 
                content: `
                    <h2>Tu Camino a la Certificación SEREMI</h2>
                    <p>Convertirse en Auxiliar de Farmacia certificado es un gran paso profesional. No solo te permite trabajar legalmente, sino que valida tus conocimientos técnicos ante la autoridad sanitaria.</p>
                    
                    <h3>1. Requisitos Básicos</h3>
                    <p>Para rendir el examen de competencia, debes cumplir con lo siguiente:</p>
                    <ul>
                        <li><span class="highlight">Licencia de Enseñanza Media</span> (Original o legalizada).</li>
                        <li><span class="highlight">Experiencia Laboral:</span> Acreditar al menos 1 año de trabajo bajo la supervisión de un Químico Farmacéutico.</li>
                        <li>Certificado de Antecedentes (Fines especiales).</li>
                    </ul>

                    <h3>2. El Examen de Competencia</h3>
                    <p>Es una prueba teórica que evalúa si dominas los aspectos críticos de la farmacia. Los temas principales son:</p>
                    <ul>
                        <li><strong>Legislación Farmacéutica:</strong> Debes dominar el <a onclick="openArticle('decreto-466-detalle')">Decreto Supremo 466</a> y la normativa de controlados.</li>
                        <li><strong>Almacenamiento y Cadena de Frío:</strong> Cómo asegurar que los medicamentos no pierdan su efectividad.</li>
                        <li><strong>Dispensación y Recetas:</strong> Identificar tipos de recetas y su validez.</li>
                    </ul>

                    <h3>3. ¿Cómo me inscribo?</h3>
                    <p>Todo el trámite se realiza de forma digital. Hemos preparado un tutorial específico para ti: <a onclick="openArticle('tutorial-as-digital')">Ver Tutorial AS Digital</a>.</p>
                ` 
            },
            { 
                id: 'decreto-466-detalle', 
                title: "¿Qué es el Decreto 466?", 
                excerpt: "Análisis de los artículos clave que siempre preguntan en el examen.", 
                content: `
                    <h2>El Reglamento que rige tu trabajo</h2>
                    <p>El Decreto Supremo N° 466 aprueba el "Reglamento de Farmacias, Droguerías, Almacenes Farmacéuticos, Botiquines y Depósitos Autorizados". Es la base legal de nuestra profesión.</p>
                    
                    <h3>Puntos Críticos para el Examen:</h3>
                    <ul>
                        <li><strong>Artículo 7:</strong> Define los tipos de establecimientos. Recuerda la diferencia entre Farmacia (dirigida por Q.F.) y Almacén Farmacéutico (arsenal limitado).</li>
                        <li><strong>Dirección Técnica:</strong> La presencia del Q.F. es obligatoria durante todo el horario de funcionamiento. Sin Q.F., la farmacia no puede abrir.</li>
                        <li><strong>El Auxiliar:</strong> Se define como el colaborador del Q.F. que, bajo su supervisión, realiza tareas de expendio.</li>
                    </ul>
                    <p>Si quieres estudiar el texto completo, puedes descargarlo en nuestra <span class="highlight" onclick="checkAuthAndStart()">Biblioteca Técnica</span> (disponible al aprobar el Nivel 1).</p>
                ` 
            },
            { 
                id: 'tutorial-as-digital', 
                title: "Tutorial: Subir documentos a AS Digital", 
                excerpt: "Guía paso a paso para solicitar tu examen de competencia online.", 
                content: `
                    <h2>Trámite en Autoridad Sanitaria Digital</h2>
                    <p>Ya no es necesario ir presencialmente a la SEREMI para inscribirte. Sigue estos pasos:</p>
                    
                    <ol>
                        <li>Ingresa a <strong>asdigital.minsal.cl</strong>.</li>
                        <li>Inicia sesión con tu <strong>Clave Única</strong>.</li>
                        <li>En el buscador de trámites escribe: "Autorización para ejercer como Auxiliar de Farmacia".</li>
                        <li>Sube tus documentos en formato PDF (asegúrate que sean legibles).</li>
                        <li>Realiza el pago del arancel correspondiente vía WebPay.</li>
                    </ol>
                    <p><strong>Consejo Pro:</strong> Guarda el número de solicitud para hacer seguimiento. La respuesta puede tardar algunas semanas.</p>
                ` 
            }
        ];

        const LINKS_PDF = { 
            decreto: "./decreto_466.pdf", 
            decreto404: "./decreto_404.pdf", 
            decreto405: "./decreto_405.pdf", 
            ley: "./ley_20724.pdf",
            posologia: "./guia_posologia.pdf",
            examen: "./modelo_examen.pdf"
        };
        
        const LEGAL_TEXTS = {
            terms: `
                <p class="font-bold mb-2">1. Naturaleza del Servicio</p>
                <p class="mb-4">Auxiliar Pro es una iniciativa independiente creada por un estudiante en formación. NO tiene afiliación con el Ministerio de Salud (MINSAL), el Instituto de Salud Pública (ISP) ni ninguna entidad gubernamental.</p>
                <p class="font-bold mb-2">2. Propósito Educativo</p>
                <p class="mb-4">El contenido aquí presentado es exclusivamente para fines de repaso y estudio personal. No garantiza la aprobación del examen de competencia ni reemplaza la documentación oficial vigente.</p>
                <p class="font-bold mb-2">3. Responsabilidad</p>
                <p class="mb-4">El creador de la aplicación no se hace responsable por errores, omisiones o el uso indebido de la información. Es deber del usuario contrastar los datos con la normativa legal actualizada (Decretos 466, 404, Código Sanitario, etc.).</p>
                <p class="font-bold mb-2">4. Modificaciones</p>
                <p>Nos reservamos el derecho de modificar o descontinuar el servicio en cualquier momento sin previo aviso.</p>
            `,
            privacy: `
                <p class="font-bold mb-2">1. Datos Recopilados</p>
                <p class="mb-4">Esta aplicación solo solicita un nombre o pseudónimo para personalizar la experiencia visual.</p>
                <p class="font-bold mb-2">2. Almacenamiento Local</p>
                <p class="mb-4">Toda la información de tu progreso (niveles, puntajes y nombre) se guarda EXCLUSIVAMENTE en la memoria de tu dispositivo (LocalStorage). No enviamos tus datos a ningún servidor externo ni base de datos.</p>
                <p class="font-bold mb-2">3. Control del Usuario</p>
                <p>Tú tienes el control total. Si borras el historial de navegación o los datos del sitio, tu progreso se eliminará permanentemente.</p>
            `,
            disclaimer: `
                <p class="font-bold mb-2 text-red-500">IMPORTANTE: DESCARGO DE RESPONSABILIDAD</p>
                <p class="mb-4">Esta aplicación web es un proyecto personal de apoyo al estudio ("Fan Made").</p>
                <ul class="list-disc pl-5 space-y-2">
                    <li>No emite certificados válidos legalmente.</li>
                    <li>No tiene relación con el proceso oficial de certificación de la SEREMI de Salud.</li>
                    <li>El uso de esta herramienta es bajo tu propia responsabilidad y criterio.</li>
                </ul>
            `
        };

        function openLegal(type) {
             const modal = document.getElementById('legal-modal');
             document.getElementById('legal-title').innerText = type === 'terms' ? "Términos y Condiciones" : (type === 'privacy' ? "Política de Privacidad" : "Descargo de Responsabilidad");
             document.getElementById('legal-content').innerHTML = LEGAL_TEXTS[type];
             modal.classList.remove('hidden'); modal.classList.add('flex');
        }

        let appState = { currentLevel: 1, levelAttempts: { 1: 0, 2: 0, 3: 0, 4: 0 }, userName: null };
        let activeLevelId=0, currentQuizQuestions=[], userAnswers=[], currentQuestionIndex=0, isReviewMode=false;
        
        const saved = localStorage.getItem('auxiliarProSimple');
        if(saved) appState = JSON.parse(saved);

        function checkAuthAndStart() { if(appState.userName) navToDashboard(); else { document.getElementById('auth-modal').classList.remove('hidden'); document.getElementById('auth-modal').classList.add('flex'); } }
        function handleRegister(e) { e.preventDefault(); const name=document.getElementById('input-name').value; if(!name.trim()) return; appState.userName=name; saveData(); document.getElementById('auth-modal').classList.add('hidden'); document.getElementById('auth-modal').classList.remove('flex'); navToDashboard(); }
        function openForum() { document.getElementById('forum-modal').classList.remove('hidden'); document.getElementById('forum-modal').classList.add('flex'); }

        function navToBlog() {
            ['view-landing', 'view-dashboard', 'view-article'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('view-blog').classList.remove('hidden');
            window.scrollTo(0,0);
            renderBlogList();
        }

        function renderBlogList() {
            const c = document.getElementById('blog-list-container'); c.innerHTML = '';
            BLOG_POSTS.forEach(p => { c.innerHTML += `<div onclick="openArticle('${p.id}')" class="bg-white border border-gray-100 rounded-xl p-5 mb-4 shadow-sm hover:shadow-md transition-all cursor-pointer group"><h3 class="font-bold text-gray-800 text-lg mb-2 group-hover:text-farmacia-green transition-colors">${p.title}</h3><p class="text-sm text-gray-500 leading-relaxed mb-3">${p.excerpt}</p><span class="text-xs text-farmacia-green font-semibold uppercase tracking-wide flex items-center gap-1">Leer Artículo <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span></div>`; });
        }

        function openArticle(id) {
            const p = BLOG_POSTS.find(x => x.id === id);
            if(!p) return;
            document.getElementById('view-blog').classList.add('hidden');
            document.getElementById('view-article').classList.remove('hidden');
            document.getElementById('article-content-container').innerHTML = `<h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 mb-6">${p.title}</h1><div class="prose">${p.content}</div><div class="mt-10 bg-green-50 border border-green-100 rounded-xl p-6 text-center"><p class="font-bold text-green-800 mb-2">¿Listo para practicar?</p><button onclick="checkAuthAndStart()" class="bg-farmacia-green hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-colors shadow-md">Ir al Simulador</button></div>`;
            window.scrollTo(0,0);
        }
        
        function navToDashboard() {
            document.getElementById('header-user-welcome').innerText = `Hola, Colega ${appState.userName}`;
            ['view-landing', 'view-blog', 'view-article'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('view-dashboard').classList.remove('hidden');
            document.getElementById('view-dashboard').classList.add('fade-in');
            renderDashboard();
        }

        function navToLanding() { ['view-dashboard', 'view-blog', 'view-article'].forEach(id => document.getElementById(id).classList.add('hidden')); document.getElementById('view-landing').classList.remove('hidden'); document.getElementById('view-landing').classList.add('fade-in'); }
        function logout() { navToLanding(); }
        function saveData() { localStorage.setItem('auxiliarProSimple', JSON.stringify(appState)); }
        function resetProgress() { if(confirm("¿Seguro?")) { localStorage.removeItem('auxiliarProSimple'); location.reload(); } }

        const metalConfig = { "Bronce": "bg-gradient-to-br from-amber-600 to-amber-800 text-white shadow-amber-200 border-amber-600", "Plata": "bg-gradient-to-br from-gray-400 to-slate-500 text-white shadow-gray-300 border-gray-400", "Oro": "bg-gradient-to-br from-yellow-400 to-yellow-600 text-white shadow-yellow-200 border-yellow-500", "Platino": "bg-gradient-to-br from-cyan-400 to-blue-600 text-white shadow-blue-200 border-blue-400" };
        
        // --- BASE DE DATOS DE PREGUNTAS COMPLETA (90 PREGUNTAS) ---
        const levelsData = [
            { 
                id: 1, title: "Conceptos Básicos", desc: "Diagnóstico (10 preg).", metalName: "Bronce", 
                questions: [ 
                    { q: "¿Qué significa D.C.I.?", options: ["Denominación Común Internacional", "Dosis Clínica", "Depto Central"], correct: 0, topic: "Definiciones" },
                    { q: "Rango temperatura refrigerador:", options: ["2°C a 8°C", "0°C a 5°C", "Ambiente"], correct: 0, topic: "Cadena de Frío" },
                    { q: "¿Cuál es un libro oficial OBLIGATORIO?", options: ["Libro de Reclamos", "Libro de Visitas", "Libro de Caja"], correct: 0, topic: "Legislación" },
                    { q: "Función principal del Auxiliar:", options: ["Recetar", "Colaborar con el Q.F.", "Diagnosticar"], correct: 1, topic: "Rol Profesional" },
                    { q: "¿Qué es la Bioequivalencia?", options: ["Mismo efecto terapéutico comprobado", "Mismo precio", "Mismo color"], correct: 0, topic: "Definiciones" },
                    { q: "Condición de venta de Antibióticos:", options: ["Venta Directa", "Receta Retenida", "Sin restricción"], correct: 1, topic: "Legislación" },
                    { q: "¿Qué hacer si se rompe la cadena de frío?", options: ["Vender rápido", "Cuarentena y avisar QF", "Congelar"], correct: 1, topic: "Cadena de Frío" },
                    { q: "¿Qué significa FIFO/FEFO?", options: ["Primero vence, primero sale", "Lo último que llega sale primero", "Marca de remedio"], correct: 0, topic: "Almacenamiento" },
                    { q: "¿Dónde se almacenan los Estupefacientes?", options: ["Estantería común", "Armario bajo llave", "Refrigerador"], correct: 1, topic: "Controlados" },
                    { q: "¿Quién es el Director Técnico?", options: ["El dueño", "El Químico Farmacéutico", "El Contador"], correct: 1, topic: "Rol Profesional" }
                ] 
            },
            { 
                id: 2, title: "Legislación", desc: "Decretos y Leyes (15 preg).", metalName: "Plata", 
                questions: [
                    { q: "¿Qué decreto regula los Psicotrópicos?", options: ["404", "466", "594"], correct: 0 }, 
                    { q: "Validez Receta Cheque:", options: ["30 días", "60 días", "1 año"], correct: 0 }, 
                    { q: "Ley de Fármacos I (Canela):", options: ["Prohíbe incentivos", "Los permite", "No dice nada"], correct: 0 }, 
                    { q: "Color estrella Estupefacientes:", options: ["Roja", "Verde", "Azul"], correct: 0 },
                    { q: "¿Qué decreto aprueba el Reglamento de Farmacias?", options: ["DS 466", "DS 594", "DS 3"], correct: 0 },
                    { q: "Vigencia de Receta Retenida (Controlados):", options: ["30 días", "60 días", "Indefinida"], correct: 0 },
                    { q: "¿Qué indica la estrella Verde?", options: ["Psicotrópico", "Estupefaciente", "Venta Directa"], correct: 0 },
                    { q: "¿Quién autoriza la instalación de una farmacia?", options: ["ISP", "Municipalidad", "Carabineros"], correct: 0 },
                    { q: "¿Qué libro registra los reclamos?", options: ["Libro de Reclamos", "Libro de Recetas", "Libro de Controlados"], correct: 0 },
                    { q: "¿Puede funcionar la farmacia sin QF?", options: ["No, nunca", "Sí, por ratos", "Sí, con auxiliar experto"], correct: 0 },
                    { q: "¿Qué es un Petitorio Farmacéutico?", options: ["Lista mínima de medicamentos obligatorios", "Lista de deseos", "Lista de precios"], correct: 0 },
                    { q: "Sanción por venta sin receta de controlados:", options: ["Sumario Sanitario", "Amonestación verbal", "Nada"], correct: 0 },
                    { q: "¿Dónde se anotan los errores de medicación?", options: ["No se anotan", "Libro de ocurrencias/Notificación RAM", "Cuaderno personal"], correct: 1 },
                    { q: "Plazo para guardar recetas cheque despachadas:", options: ["1 año", "6 meses", "2 años"], correct: 0 },
                    { q: "¿Qué es el Formulario Nacional?", options: ["Listado oficial de medicamentos esenciales", "Un formulario de impuestos", "Una receta tipo"], correct: 0 }
                ] 
            },
            { 
                id: 3, title: "Farmacología", desc: "Posología y Cálculo (25 preg).", metalName: "Oro", 
                questions: [ 
                    { q: "Dosis 500mg. Tab 250mg. ¿Cuántas?", options: ["1", "2", "3"], correct: 1 }, 
                    { q: "10ml c/8h x 5 días. Total:", options: ["150ml", "100ml", "50ml"], correct: 0 },
                    { q: "Vía de administración más rápida:", options: ["Endovenosa", "Oral", "Tópica"], correct: 0 },
                    { q: "Diferencia entre crema y ungüento:", options: ["Ungüento es más graso", "Crema es más grasa", "Son iguales"], correct: 0 },
                    { q: "Posología: 1g al día. Tab 500mg. ¿Diarias?", options: ["2", "1", "3"], correct: 0 },
                    { q: "¿Qué es un AINE?", options: ["Antiinflamatorio No Esteroideo", "Antibiótico", "Antiviral"], correct: 0 },
                    { q: "Dosis niño 10kg. 15mg/kg. Total:", options: ["150mg", "100mg", "15mg"], correct: 0 },
                    { q: "Jarabe 100mg/5ml. Dosis 200mg. ¿Ml?", options: ["10ml", "5ml", "20ml"], correct: 0 },
                    { q: "Efecto del Paracetamol:", options: ["Analgésico/Antipirético", "Antibiótico", "Antihistamínico"], correct: 0 },
                    { q: "Uso de Metformina:", options: ["Diabetes", "Hipertensión", "Colesterol"], correct: 0 },
                    { q: "Uso de Losartán:", options: ["Hipertensión", "Diabetes", "Gastritis"], correct: 0 },
                    { q: "Posología: 1 cada 12h por 7 días. Total:", options: ["14", "7", "21"], correct: 0 },
                    { q: "¿Qué es un comprimido recubierto?", options: ["Protege el fármaco del ácido", "Es para masticar", "Es efervescente"], correct: 0 },
                    { q: "Vía Sublingual evita:", options: ["Primer paso hepático", "El estómago", "La boca"], correct: 0 },
                    { q: "Antibiótico común para amigdalitis:", options: ["Amoxicilina", "Ibuprofeno", "Loratadina"], correct: 0 },
                    { q: "Posología: 2 puff cada 6h. Al día:", options: ["8 puff", "6 puff", "4 puff"], correct: 0 },
                    { q: "Uso de Omeprazol:", options: ["Protector gástrico", "Dolor de cabeza", "Alergia"], correct: 0 },
                    { q: "Dosis 0.5mg. Tab 1mg ranurada:", options: ["Mitad", "Entera", "Cuarto"], correct: 0 },
                    { q: "Gotas: 1ml = 20 gotas. 3ml son:", options: ["60 gotas", "30 gotas", "20 gotas"], correct: 0 },
                    { q: "Antihistamínico clásico:", options: ["Clorfenamina", "Diclofenaco", "Enalapril"], correct: 0 },
                    { q: "Posología: 5ml cada 8h. Frasco 120ml. Dura:", options: ["8 días", "5 días", "10 días"], correct: 0 },
                    { q: "¿Qué es suspensión extemporánea?", options: ["Polvo para preparar con agua", "Jarabe listo", "Inyectable"], correct: 0 },
                    { q: "Dosis máxima Paracetamol adulto:", options: ["4g al día", "1g al día", "10g al día"], correct: 0 },
                    { q: "Uso de Salbutamol:", options: ["Broncodilatador", "Mucolítico", "Corticoide"], correct: 0 },
                    { q: "Posología: 3mg/kg. Paciente 20kg:", options: ["60mg", "20mg", "30mg"], correct: 0 }
                ] 
            },
            { 
                id: 4, title: "Simulacro Final", desc: "Integración (40 preg).", metalName: "Platino", 
                questions: [ 
                    { q: "Receta Cheque plazo:", options: ["30 días", "60 días"], correct: 0 }, 
                    { q: "Dosis pediátrica estándar Amoxicilina:", options: ["50-100 mg/kg/día", "10 mg/kg/día"], correct: 0 },
                    { q: "Paciente pide antibiótico sin receta por dolor muela:", options: ["Negar venta y derivar", "Vender", "Dar analgésico"], correct: 0 },
                    { q: "Temperatura crítica refri:", options: ["Sobre 8°C", "Bajo 15°C"], correct: 0 },
                    { q: "Vigencia Receta Magistral:", options: ["40 días", "30 días"], correct: 0 },
                    { q: "Sildenafil interacción grave con:", options: ["Nitratos", "Aspirina"], correct: 0 },
                    { q: "Clonazepam pertenece a lista:", options: ["IV", "II"], correct: 0 },
                    { q: "Morfina pertenece a lista:", options: ["I (Estupefacientes)", "IV"], correct: 0 },
                    { q: "Cálculo: 250mg/5ml. Dosis 500mg. Ml:", options: ["10ml", "5ml"], correct: 0 },
                    { q: "Cálculo: 1g c/8h. Viales 1g. 3 días. Total viales:", options: ["9", "3"], correct: 0 },
                    { q: "Diferencia Lote vs Vencimiento:", options: ["Lote traza fabricación, Vencimiento caducidad", "Son lo mismo"], correct: 0 },
                    { q: "¿Qué es la Farmacovigilancia?", options: ["Reporte de efectos adversos", "Vigilar robos"], correct: 0 },
                    { q: "RAM común de IECA (Enalapril):", options: ["Tos seca", "Sueño"], correct: 0 },
                    { q: "RAM común de antihistamínicos 1ra gen:", options: ["Sueño", "Insomnio"], correct: 0 },
                    { q: "¿Qué es un Placebo?", options: ["Sustancia inerte", "Fármaco potente"], correct: 0 },
                    { q: "Medicamento LASA:", options: ["Se parecen o suenan igual", "Son láser"], correct: 0 },
                    { q: "Vía Otica es:", options: ["Oído", "Ojo"], correct: 0 },
                    { q: "Vía Oftálmica es:", options: ["Ojo", "Oído"], correct: 0 },
                    { q: "Insulina se guarda en:", options: ["Refrigerador (2-8°C)", "Congelador"], correct: 0 },
                    { q: "Forma farmacéutica 'Supositorio':", options: ["Sólida rectal", "Semisólida"], correct: 0 },
                    { q: "Forma farmacéutica 'Óvulo':", options: ["Sólida vaginal", "Oral"], correct: 0 },
                    { q: "Cálculo: 0.25mg. Tab 0.5mg:", options: ["Mitad", "Dos"], correct: 0 },
                    { q: "Receta retenida control de saldo:", options: ["Se descuenta cantidad vendida al reverso", "Se archiva y ya"], correct: 0 },
                    { q: "Libro de Psicotrópicos lo llena:", options: ["Q.F.", "Auxiliar"], correct: 0 },
                    { q: "Auxiliar puede inyectar:", options: ["Si tiene curso y autorización", "Siempre"], correct: 0 },
                    { q: "Venta de alcohol:", options: ["Sin restricción", "Regulado"], correct: 0 },
                    { q: "Medicamento vencido:", options: ["Se retira a mermas para destrucción", "Se vende barato"], correct: 0 },
                    { q: "Cálculo: 600mg. Tab 300mg:", options: ["2", "1"], correct: 0 },
                    { q: "Cálculo: 5ml c/12h. 7 días. Total:", options: ["70ml", "35ml"], correct: 0 },
                    { q: "Cálculo: 1 cada 24h. 30 días. Caja 30:", options: ["1 caja", "2 cajas"], correct: 0 },
                    { q: "Cálculo: 100UI. 100UI/ml:", options: ["1ml", "10ml"], correct: 0 },
                    { q: "Uso de Furosemida:", options: ["Diurético", "Antibiótico"], correct: 0 },
                    { q: "Uso de Atorvastatina:", options: ["Colesterol", "Diabetes"], correct: 0 },
                    { q: "Uso de Levotiroxina:", options: ["Hipotiroidismo", "Hipertiroidismo"], correct: 0 },
                    { q: "Bioequivalente marca:", options: ["Franja amarilla", "Estrella"], correct: 0 },
                    { q: "Cenabast logo significa:", options: ["Precio económico fijado", "Mala calidad"], correct: 0 },
                    { q: "Receta magistral es:", options: ["Preparada para un paciente específico", "Industrial"], correct: 0 },
                    { q: "Principio activo Tapsin:", options: ["Paracetamol (+ otros)", "Ibuprofeno"], correct: 0 },
                    { q: "Principio activo Aspirina:", options: ["Ácido Acetilsalicílico", "Paracetamol"], correct: 0 },
                    { q: "Fin del curso:", options: ["¡Felicidades!", "Repetir"], correct: 0 }
                ] 
            }
        ];

        function renderDashboard() {
            const container = document.getElementById('levels-container');
            const rewardsContainer = document.getElementById('rewards-section');
            container.innerHTML = '';
            
            const isUnlocked = appState.currentLevel > 1;
            const progressPercent = Math.min(((appState.currentLevel - 1) / levelsData.length) * 100, 100); 
            document.getElementById('progress-bar').style.width = Math.max(5, progressPercent) + "%";
            document.getElementById('header-medal-status').innerText = `Rango: ${levelsData[Math.min(appState.currentLevel, levelsData.length)-1]?.metalName || 'Novato'}`;

            levelsData.forEach((level) => {
                const isLocked = level.id > appState.currentLevel;
                const isCompleted = level.id < appState.currentLevel;
                const attemptsUsed = appState.levelAttempts[level.id] || 0;
                const maxAttempts = level.id === 1 ? 999 : 2;
                const isFailedAndLocked = attemptsUsed >= maxAttempts && !isCompleted && !isLocked;

                let cardClasses = "bg-white p-5 rounded-xl shadow-sm border flex items-center justify-between transition-all relative overflow-hidden ";
                let iconClasses = "w-14 h-14 rounded-full flex items-center justify-center font-bold text-xl border-2 shadow-lg ";
                let statusLabel = "";
                let statusColorClass = "";

                if (isCompleted) {
                    cardClasses += "hover:shadow-md cursor-pointer border-green-200 bg-green-50/30";
                    iconClasses += metalConfig[level.metalName] + " medal-shine";
                    statusLabel = "¡LOGRADO!";
                    statusColorClass = "text-green-600 bg-green-100 border-green-200";
                } else if (isLocked) {
                    cardClasses += "locked-level border-gray-100 bg-gray-50";
                    iconClasses += "bg-gray-200 text-gray-400 border-gray-300";
                    statusLabel = "POR APROBAR";
                    statusColorClass = "text-gray-400 bg-gray-100 border-gray-200";
                } else if (isFailedAndLocked) {
                    cardClasses += "bg-red-50 border-red-200 cursor-not-allowed";
                    iconClasses += "bg-red-100 text-red-500 border-red-300";
                    statusLabel = "INTENTOS AGOTADOS";
                    statusColorClass = "text-red-600 bg-red-100 border-red-200";
                } else {
                    cardClasses += "hover:shadow-md cursor-pointer border-blue-200 hover:border-farmacia-green";
                    iconClasses += metalConfig[level.metalName] + " medal-shine";
                    statusLabel = "DISPONIBLE";
                    statusColorClass = "text-blue-600 bg-blue-100 border-blue-200";
                }

                const metalBadge = !isLocked ? `<span class="text-[10px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wider mb-1 inline-block border bg-gray-50 text-gray-600 border-gray-200">${level.metalName}</span>` : '';
                const statusBadge = `<span class="text-[10px] font-bold px-2 py-1 rounded-md border ${statusColorClass} uppercase tracking-wider">${statusLabel}</span>`;
                let attemptText = (!isLocked && !isCompleted && level.id > 1 && !isFailedAndLocked) ? `<span class="text-[10px] text-gray-400 block mt-1">Intentos: ${attemptsUsed}/${maxAttempts}</span>` : "";
                let clickAction = isCompleted ? `alert('Ya aprobaste este nivel. ¡Sigue avanzando!')` : (!isLocked && !isFailedAndLocked ? `startLevel(${level.id})` : "alert('Nivel bloqueado.')");

                container.innerHTML += `
                <div class="${cardClasses}" onclick="${clickAction}">
                    <div class="flex items-center gap-4 relative z-10 w-full">
                        <div class="${iconClasses} shrink-0">
                            ${isCompleted ? '✓' : level.id}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <div>
                                    ${metalBadge}
                                    <h3 class="font-bold text-gray-800 leading-tight truncate pr-2">${level.title}</h3>
                                </div>
                                <div class="shrink-0">
                                    ${statusBadge}
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1 line-clamp-2">${level.desc}</p>
                            ${attemptText}
                        </div>
                    </div>
                </div>`;
            });

            if (isUnlocked) {
                rewardsContainer.innerHTML = `
                <div class="library-unlocked bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200 shadow-md">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="bg-blue-600 text-white p-2 rounded-lg shadow-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg></div>
                        <div><h4 class="font-bold text-gray-900 text-lg">Biblioteca Técnica</h4><p class="text-xs text-blue-700 font-medium">¡Material desbloqueado!</p></div>
                    </div>
                    <div class="space-y-3">
                        <a href="${LINKS_PDF.decreto404}" target="_blank" class="w-full bg-white hover:bg-blue-50 text-left p-3 rounded-lg border border-blue-200 flex items-center justify-between group no-underline"><span class="flex items-center gap-2 text-sm font-semibold text-gray-700">📜 Guía Decreto 404</span><span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">Descargar</span></a>
                        <a href="${LINKS_PDF.decreto405}" target="_blank" class="w-full bg-white hover:bg-blue-50 text-left p-3 rounded-lg border border-blue-200 flex items-center justify-between group no-underline"><span class="flex items-center gap-2 text-sm font-semibold text-gray-700">📜 Guía Decreto 405</span><span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">Descargar</span></a>
                        <a href="${LINKS_PDF.ley}" target="_blank" class="w-full bg-white hover:bg-blue-50 text-left p-3 rounded-lg border border-blue-200 flex items-center justify-between group no-underline"><span class="flex items-center gap-2 text-sm font-semibold text-gray-700">⚖️ Guía Ley 20.724</span><span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">Descargar</span></a>
                        <a href="${LINKS_PDF.decreto}" target="_blank" class="w-full bg-white hover:bg-blue-50 text-left p-3 rounded-lg border border-blue-200 flex items-center justify-between group no-underline"><span class="flex items-center gap-2 text-sm font-semibold text-gray-700">📜 Guía Decreto 466</span><span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">Descargar</span></a>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-fuchsia-50 rounded-xl p-6 border border-purple-200 shadow-md mt-4">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="bg-purple-600 text-white p-2 rounded-lg shadow-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg></div>
                        <div><h4 class="font-bold text-gray-900 text-lg">Foro de Colegas</h4><p class="text-xs text-purple-700 font-medium">Comunidad Auxiliar Pro</p></div>
                    </div>
                    <p class="text-xs text-gray-600 mb-4">Únete a nuestra comunidad en WhatsApp para compartir dudas.</p>
                    <button onclick="openForum()" class="w-full bg-purple-600 hover:bg-purple-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition-colors">Entrar al Foro</button>
                </div>`;
            } else {
                rewardsContainer.innerHTML = `<div class="bg-gray-100 rounded-xl p-4 flex items-center gap-4 opacity-60"><div class="bg-gray-300 p-3 rounded-lg text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg></div><div><h4 class="font-bold text-gray-700">Biblioteca y Foros</h4><p class="text-xs text-gray-500">🔒 Aprueba el Nivel 1 para desbloquear.</p></div></div>`;
            }
        }

        function startLevel(levelId) {
            const level = levelsData.find(l => l.id === levelId);
            activeLevelId = levelId;
            currentQuizQuestions = level.questions;
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuizQuestions.length).fill(null);
            isReviewMode = false;
            document.getElementById('quiz-title').innerText = `Examen ${level.metalName}`;
            document.getElementById('quiz-subtitle').innerText = `Pregunta 1 de ${currentQuizQuestions.length}`;
            document.getElementById('quiz-content-active').classList.remove('hidden');
            document.getElementById('quiz-footer').classList.remove('hidden');
            document.getElementById('quiz-content-result').classList.add('hidden');
            document.getElementById('quiz-modal').classList.remove('hidden');
            document.getElementById('quiz-modal').classList.add('flex');
            showQuestion();
        }

        function closeQuiz() { document.getElementById('quiz-modal').classList.add('hidden'); document.getElementById('quiz-modal').classList.remove('flex'); renderDashboard(); }

        function showQuestion() {
            const q = currentQuizQuestions[currentQuestionIndex];
            const currentAnswer = userAnswers[currentQuestionIndex];
            document.getElementById('current-q-num').innerText = currentQuestionIndex + 1;
            document.getElementById('total-q-num').innerText = currentQuizQuestions.length;
            const container = document.getElementById('quiz-question-container');
            container.innerHTML = `<h4 class="text-lg font-bold text-gray-800 mb-6">${q.q}</h4>`;
            const optionsContainer = document.createElement('div');
            optionsContainer.className = "space-y-3";
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-lg border transition-all option-btn text-sm md:text-base font-medium ";
                if (isReviewMode) {
                    btn.disabled = true;
                    if (idx === q.correct) { btn.className += "bg-green-100 border-green-500 text-green-800 font-bold"; btn.innerHTML = `${opt} <span class="float-right">✅</span>`; }
                    else if (idx === currentAnswer && idx !== q.correct) { btn.className += "bg-red-50 border-red-500 text-red-800"; btn.innerHTML = `${opt} <span class="float-right">❌</span>`; }
                    else { btn.className += "border-gray-200 opacity-60"; btn.innerText = opt; }
                } else {
                    if (idx === currentAnswer) btn.className += "bg-blue-50 border-blue-500 text-blue-800 shadow-inner ring-1 ring-blue-500";
                    else btn.className += "border-gray-200 hover:bg-gray-50 hover:border-blue-300";
                    btn.onclick = () => selectAnswer(idx);
                    btn.innerText = opt;
                }
                optionsContainer.appendChild(btn);
            });
            container.appendChild(optionsContainer);
            const nextBtn = document.getElementById('next-btn');
            nextBtn.onclick = null;
            if (isReviewMode) {
                nextBtn.disabled = false;
                nextBtn.innerText = (currentQuestionIndex === currentQuizQuestions.length - 1) ? "Volver al Resumen" : "Siguiente";
                nextBtn.onclick = (currentQuestionIndex === currentQuizQuestions.length - 1) ? () => showResultSummary() : nextQuestion;
            } else {
                nextBtn.disabled = (currentAnswer === null);
                nextBtn.innerText = (currentQuestionIndex === currentQuizQuestions.length - 1) ? "Finalizar Examen" : "Siguiente";
                nextBtn.onclick = (currentQuestionIndex === currentQuizQuestions.length - 1) ? finishLevel : nextQuestion;
            }
        }

        function selectAnswer(idx) { if (isReviewMode) return; userAnswers[currentQuestionIndex] = idx; showQuestion(); }
        function nextQuestion() { currentQuestionIndex++; showQuestion(); }

        function finishLevel() {
            let score = 0;
            userAnswers.forEach((ans, idx) => { if (ans === currentQuizQuestions[idx].correct) score++; });
            if (!appState.levelAttempts) appState.levelAttempts = {1:0, 2:0, 3:0, 4:0};
            appState.levelAttempts[activeLevelId]++;
            const passed = score >= Math.ceil(currentQuizQuestions.length * 0.7);
            if (passed && activeLevelId === appState.currentLevel) appState.currentLevel++;
            saveData();
            showResultSummary(score, passed);
        }

        function showResultSummary(scoreInput, passedInput) {
            let score = scoreInput, passed = passedInput;
            if (typeof score !== 'number') { 
                score = 0; 
                userAnswers.forEach((ans, idx) => { if (ans === currentQuizQuestions[idx].correct) score++; }); 
                passed = score >= Math.ceil(currentQuizQuestions.length * 0.7); 
            }
            
            // Lógica de Feedback de Debilidad (Solo Nivel 1)
            let feedbackHtml = "";
            if (activeLevelId === 1 && !passed) {
                let wrongTopics = {};
                userAnswers.forEach((ans, idx) => {
                    if (ans !== currentQuizQuestions[idx].correct) {
                        const topic = currentQuizQuestions[idx].topic;
                        wrongTopics[topic] = (wrongTopics[topic] || 0) + 1;
                    }
                });
                // Encontrar el tema con más errores
                let maxErrors = 0;
                let weakTopic = "";
                for (const topic in wrongTopics) {
                    if (wrongTopics[topic] > maxErrors) {
                        maxErrors = wrongTopics[topic];
                        weakTopic = topic;
                    }
                }
                if (weakTopic) feedbackHtml = `Te sugerimos repasar: <strong>${weakTopic}</strong>`;
            }

            document.getElementById('quiz-content-active').classList.add('hidden');
            document.getElementById('quiz-footer').classList.add('hidden');
            document.getElementById('quiz-content-result').classList.remove('hidden');
            document.getElementById('weakness-feedback').innerHTML = feedbackHtml;
            document.getElementById('weakness-feedback').classList.toggle('hidden', !feedbackHtml);

            const resultTitle = document.getElementById('result-title');
            const resultMsg = document.getElementById('result-message');
            const resultIcon = document.getElementById('result-icon');
            const retryBtn = document.getElementById('btn-retry');
            document.getElementById('result-score').innerText = `${score} / ${currentQuizQuestions.length}`;
            
            if (passed) {
                resultIcon.innerHTML = `<div class="bg-green-100 p-4 rounded-full text-green-600"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg></div>`;
                resultTitle.innerText = "¡Aprobado!";
                if (activeLevelId === 1) resultMsg.innerText = "¡Felicidades! Has desbloqueado la Biblioteca y los Foros.";
                else if (activeLevelId === 4) { confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } }); resultMsg.innerText = "¡CERTIFICADO MASTER!"; }
                else resultMsg.innerText = "Has superado el desafío.";
                retryBtn.classList.add('hidden');
            } else {
                resultIcon.innerHTML = `<div class="bg-red-100 p-4 rounded-full text-red-600"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg></div>`;
                resultTitle.innerText = "Reprobado";
                resultMsg.innerText = "No alcanzaste el mínimo.";
                const attemptsUsed = appState.levelAttempts[activeLevelId];
                const maxAttempts = activeLevelId === 1 ? 999 : 2;
                if (attemptsUsed >= maxAttempts) { retryBtn.disabled = true; retryBtn.className = "w-full bg-gray-300 text-gray-500 font-bold py-3 rounded-lg cursor-not-allowed"; retryBtn.innerText = "Intentos Agotados"; }
                else { retryBtn.disabled = false; retryBtn.classList.remove('hidden'); retryBtn.className = "w-full bg-farmacia-green hover:bg-green-600 text-white font-bold py-3 rounded-lg transition-colors"; retryBtn.innerText = `Reintentar (Intento ${attemptsUsed + 1}/${maxAttempts})`; }
            }
        }

        function startReviewMode() { isReviewMode = true; currentQuestionIndex = 0; document.getElementById('quiz-content-result').classList.add('hidden'); document.getElementById('quiz-content-active').classList.remove('hidden'); document.getElementById('quiz-footer').classList.remove('hidden'); showQuestion(); }
        function retryLevel() { startLevel(activeLevelId); }
    </script>
</body>
</html>
