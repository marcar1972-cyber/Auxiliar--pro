<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auxiliar Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root">Cargando sistema...</div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithRedirect, getRedirectResult } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const { useState, useEffect } = React;

        // --- CREDENCIALES ---
        const firebaseConfig = {
          apiKey: "AIzaSyDNhuSBBhmmQSV0BHC8MOtLKgAUpvtfWfE",
          authDomain: "auxiliar-pro.firebaseapp.com",
          projectId: "auxiliar-pro",
          storageBucket: "auxiliar-pro.firebasestorage.app",
          messagingSenderId: "342196612566",
          appId: "1:342196612566:web:c7f34365c4e10502e60877"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // --- ICONOS SVG (Est√°ticos para evitar errores) ---
        const Icons = {
            Brain: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-12 h-12"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z" /><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z" /></svg>,
            Google: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" className="w-5 h-5"><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M2.18 14.1c-.19-.57-.29-1.18-.29-1.8s.1-1.23.29-1.8V7.66H.35C-.4 9.13-.81 10.76-.81 12.3c0 1.54.41 3.17 1.16 4.64l1.83-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/><path d="M24 12.3c0-.86-.08-1.68-.21-2.47H12v4.68h6.72c-.29 1.56-1.16 2.88-2.47 3.76v3.13h4.01c2.34-2.16 3.69-5.34 3.69-9.1z" fill="#4285F4"/></svg>,
            Shield: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-6 h-6"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>,
            // ... Resto de iconos simplificados ...
            Simple: ({ d, className="w-6 h-6" }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>
        };
        
        const PATHS = {
            user: "M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2 M12 3a4 4 0 1 0 0 8 4 4 0 0 0 0-8z",
            lock: "M7 11V7a5 5 0 0 1 10 0v4 M3 11h18v11H3z",
            arrowRight: "M5 12h14 M12 5l7 7-7 7",
            arrowLeft: "M19 12H5 M12 19l-7-7 7-7",
            check: "M22 11.08V12a10 10 0 1 1-5.93-9.14 M22 4L12 14.01l-3-3",
            book: "M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",
            msg: "M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",
            logout: "M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4 M16 17l5-12-5 7 M21 12H9",
            file: "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6",
            star: "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-5.82 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",
            award: "M12 8a6 6 0 0 0-6 6c0 4.41 4 8 6 8s6-3.59 6-8a6 6 0 0 0-6-6z M15.41 12.59L12 16l-3.41-3.41 M12 2v4"
        };

        // --- BIBLIOTECA DE ARCHIVOS ---
        const BIBLIOTECA_DATA = [
            { titulo: "M√≥dulo 1: La Base Legal", color: "text-emerald-800", borde: "border-emerald-500", iconColor: "text-emerald-600", bgIcon: "bg-emerald-100", archivos: [{ nombre: "Decreto Supremo 466", desc: "PDF ‚Ä¢ Lectura Obligatoria", url: "https://drive.google.com/file/d/1x1vDcOIz1r1PmN1F7InUcZTDRJVBLmIo/view?usp=sharing" }, { nombre: "Listado de Controlados", desc: "PDF ‚Ä¢ Referencia", url: "#" }] },
            { titulo: "M√≥dulo 2: Gesti√≥n y Almacenamiento", color: "text-blue-800", borde: "border-blue-500", iconColor: "text-blue-600", bgIcon: "bg-blue-100", archivos: [{ nombre: "Manual Buenas Pr√°cticas", desc: "PDF ‚Ä¢ Procedimientos", url: "#" }] },
            { titulo: "M√≥dulo 3: Atenci√≥n y Farmacolog√≠a", color: "text-fuchsia-800", borde: "border-fuchsia-500", iconColor: "text-fuchsia-600", bgIcon: "bg-fuchsia-100", archivos: [{ nombre: "Gu√≠a de Bioequivalencia", desc: "PDF ‚Ä¢ Minsal", url: "#" }, { nombre: "Psicof√°rmacos", desc: "PDF ‚Ä¢ Material de Estudio", url: "https://drive.google.com/file/d/1AFwbouD6gy-rTSXw6AEfiBgwDyxRnoGq/view?usp=sharing" }] }
        ];

        // --- BANCO DE PREGUNTAS ---
        const DB_1A = [
            { id: 1, cat: "Legislaci√≥n", pregunta: "¬øQu√© decreto aprueba el reglamento de farmacias?", opciones: ["D.S. 466", "D.S. 594", "D.S. 707"], correcta: 0, explicacion: "El D.S. 466 es la normativa base." },
            { id: 2, cat: "Almacenamiento", pregunta: "Rango T¬∞ Refrigerador:", opciones: ["0-4¬∞C", "2-8¬∞C", "8-15¬∞C"], correcta: 1, explicacion: "Cadena de fr√≠o estricta: 2¬∞C a 8¬∞C." },
            { id: 3, cat: "Conceptos", pregunta: "Significado de OTC:", opciones: ["Venta Directa", "Receta Cheque", "Psicotr√≥pico"], correcta: 0, explicacion: "Over The Counter (Sin receta)." },
            { id: 4, cat: "Legislaci√≥n", pregunta: "¬øResponsable t√©cnico de la Farmacia?", opciones: ["El due√±o", "El Qu√≠mico Farmac√©utico", "El Auxiliar"], correcta: 1, explicacion: "La direcci√≥n t√©cnica es del Q.F." },
            { id: 5, cat: "Infraestructura", pregunta: "Altura m√≠nima medicamentos del suelo:", opciones: ["Suelo directo", "10-15 cm (tarimas)", "1 metro"], correcta: 1, explicacion: "Para evitar humedad y contaminaci√≥n." },
            { id: 6, cat: "Conceptos", pregunta: "¬øQu√© es un medicamento gen√©rico?", opciones: ["Mala calidad", "Copia ilegal", "Nombre del principio activo"], correcta: 2, explicacion: "Se vende por su DCI (Denominaci√≥n Com√∫n Internacional)." },
            { id: 7, cat: "Rol", pregunta: "Funci√≥n principal del auxiliar:", opciones: ["Diagnosticar", "Colaborar en dispensaci√≥n", "Recetar"], correcta: 1, explicacion: "Apoyo log√≠stico y de venta informada." },
            { id: 8, cat: "Higiene", pregunta: "¬øCu√°ndo lavarse las manos?", opciones: ["Solo al llegar", "Antes y despu√©s de atender/ba√±o", "Nunca"], correcta: 1, explicacion: "Norma b√°sica de higiene sanitaria." },
            { id: 9, cat: "Atenci√≥n", pregunta: "Actitud ante un cliente enojado:", opciones: ["Gritar m√°s fuerte", "Escucha activa y empat√≠a", "Ignorarlo"], correcta: 1, explicacion: "Mantener la calma y ser profesional." },
            { id: 10, cat: "Instituciones", pregunta: "¬øQu√© funci√≥n cumple el ISP?", opciones: ["Vender remedios", "Controlar y fiscalizar medicamentos", "Administrar hospitales"], correcta: 1, explicacion: "Es la autoridad encargada del control sanitario de productos farmac√©uticos." }
        ];

        const DB_NIVEL_2 = [
            { id: 26, cat: "Farmacolog√≠a", pregunta: "¬øQu√© es la Bioequivalencia?", opciones: ["M√°s barato", "Misma eficacia y seguridad", "Gen√©rico simple"], correcta: 1, explicacion: "Certificaci√≥n de calidad terap√©utica." },
            { id: 27, cat: "Almacenamiento", pregunta: "¬øQu√© es FEFO?", opciones: ["Primero vence, primero sale", "Primero entra, primero sale", "Ninguna"], correcta: 0, explicacion: "Gesti√≥n de vencimientos." },
            { id: 28, cat: "Legislaci√≥n", pregunta: "¬øLibros obligatorios en farmacia?", opciones: ["Solo reclamos", "Controlados, Recetario, Reclamos", "Ninguno"], correcta: 1, explicacion: "Son obligatorios y deben estar timbrados." }
        ];

        const DB_AVANZADO = [
            { id: 29, cat: "C√°lculo", pregunta: "Dosis 500mg. Disponibles 250mg. ¬øCantidad?", opciones: ["1", "2", "3"], correcta: 1, explicacion: "500/250 = 2 comprimidos." },
            { id: 30, cat: "C√°lculo", pregunta: "Jarabe 100ml. Dosis 5ml c/12hrs. ¬øDuraci√≥n?", opciones: ["5 d√≠as", "10 d√≠as", "7 d√≠as"], correcta: 1, explicacion: "10ml diarios. 100/10 = 10 d√≠as." },
            { id: 31, cat: "Legislaci√≥n", pregunta: "Sanciones sanitarias:", opciones: ["Solo multas", "Multas, clausura, sumario", "C√°rcel directa"], correcta: 1, explicacion: "El ISP o SEREMI instruye sumario sanitario." }
        ];

        const getQuestionsForLevel = (levelType) => {
            if (levelType === '1A') return DB_1A;
            if (levelType === '2') return [...DB_NIVEL_2, ...DB_1A].slice(0, 5); 
            if (levelType === '3') return [...DB_AVANZADO, ...DB_NIVEL_2].slice(0, 7);
            if (levelType === '4') return [...DB_AVANZADO, ...DB_NIVEL_2, ...DB_1A].slice(0, 10);
            return [];
        };

        const getTitleForLevel = (levelType) => {
            if (levelType === '1A') return "Nivel 1: Diagn√≥stico";
            if (levelType === '2') return "Nivel 2: Cuestionario Intermedio";
            if (levelType === '3') return "Nivel 3: Cuestionario Avanzado";
            if (levelType === '4') return "Nivel 4: Simulacro Final";
            return "Evaluaci√≥n";
        };

        // --- COMPONENTES VISUALES ---
        const Button = ({ children, onClick, variant = 'primary', className = '', fullWidth = false, disabled = false }) => {
            const base = `rounded-xl font-bold transition-all flex items-center justify-center gap-2 shadow-md px-4 py-3 active:scale-95`;
            const variants = {
                primary: "bg-emerald-600 text-white hover:bg-emerald-700 border-b-4 border-emerald-800",
                secondary: "bg-white text-emerald-700 border-2 border-emerald-100 hover:border-emerald-300",
                gold: "bg-yellow-500 text-white border-b-4 border-yellow-700",
                ghost: "text-gray-500 hover:bg-gray-100 shadow-none border-none",
                locked: "bg-gray-100 text-gray-400 border-2 border-gray-200 shadow-none cursor-not-allowed active:scale-100"
            };
            return <button onClick={!disabled ? onClick : null} className={`${base} ${disabled ? variants.locked : variants[variant]} ${fullWidth ? 'w-full' : ''} ${className}`}>{children}</button>;
        };

        const Card = ({ children, className = '' }) => <div className={`bg-white rounded-2xl shadow-sm border border-gray-100 p-6 ${className}`}>{children}</div>;

        const LevelBadgeHeader = ({ level }) => {
            const badges = {
                1: { icon: "shield", text: "Aspirante", color: "text-gray-500", bg: "bg-gray-100", border: "border-gray-300" },
                2: { icon: "shield", text: "Bronce", color: "text-orange-700", bg: "bg-orange-50", border: "border-orange-300" },
                3: { icon: "shield", text: "Plata", color: "text-slate-700", bg: "bg-slate-100", border: "border-slate-300" },
                4: { icon: "star", text: "Oro", color: "text-yellow-700", bg: "bg-yellow-50", border: "border-yellow-300" },
                5: { icon: "award", text: "Auxiliar Pro", color: "text-emerald-700", bg: "bg-emerald-50", border: "border-emerald-300" }
            };
            const badge = badges[level >= 5 ? 5 : level >= 4 ? 4 : level];
            
            return (
                <div className={`w-full p-6 rounded-3xl border-2 ${badge.bg} ${badge.border} flex flex-col items-center justify-center mb-8 relative overflow-hidden`}>
                    <div className="relative z-10 flex flex-col items-center">
                        <div className={`p-4 bg-white rounded-full shadow-lg mb-3 border-4 ${badge.border}`}>
                           {badge.icon === 'star' ? <Icons.Star className={`w-12 h-12 ${badge.color} fill-current`} /> : <Icons.Simple d={PATHS.shield} className={`w-12 h-12 ${badge.color}`} />}
                        </div>
                        <h3 className={`text-2xl font-black uppercase tracking-widest ${badge.color}`}>{badge.text}</h3>
                        <p className="text-sm font-medium text-gray-500 mt-1">Nivel {level >= 5 ? 'Finalizado' : level}</p>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('landing');
            const [showAuth, setShowAuth] = useState(false);
            const [userLevel, setUserLevel] = useState(1);
            const [progress, setProgress] = useState({ '1A': false });
            const [currentQuizType, setCurrentQuizType] = useState(null);
            const [errorMsg, setErrorMsg] = useState('');

            useEffect(() => {
                auth.onAuthStateChanged(async (currentUser) => {
                    if (currentUser) {
                        setUser(currentUser);
                        setShowAuth(false);
                        setView('home');
                        const docRef = db.collection("users").doc(currentUser.uid);
                        docRef.get().then((doc) => {
                            if (doc.exists) {
                                const data = doc.data();
                                setUserLevel(data.level || 1);
                                setProgress(data.progress || { '1A': false });
                            } else {
                                docRef.set({ level: 1, progress: { '1A': false }, email: currentUser.email });
                            }
                            setLoading(false);
                        });

                        // Detectar regreso de Google Redirect
                        getRedirectResult(auth).then((result) => {
                            if (result.user) console.log("Logged with Google");
                        }).catch((error) => {
                            console.error(error);
                        });
                    } else {
                        setUser(null);
                        setLoading(false);
                    }
                });
            }, []);

            const handleLogin = async (email, pass, isReg, sec) => {
                setErrorMsg('');
                if (isReg && parseInt(sec) !== 7) { setErrorMsg("Error seguridad (4+3=?)"); return; }
                try {
                    if(isReg) await createUserWithEmailAndPassword(auth, email, pass);
                    else await signInWithEmailAndPassword(auth, email, pass);
                } catch(e) { setErrorMsg(e.message); }
            };

            const handleGoogle = async () => {
                 try { await signInWithRedirect(auth, googleProvider); } catch(e) { setErrorMsg(e.message); }
            };

            const handleLogout = async () => {
                await signOut(auth);
                setUserLevel(1);
                setView('landing');
            };

            const handleQuizFinish = (passed) => {
                if (passed) {
                    const newProgress = { ...progress, [currentQuizType]: true };
                    let newLevel = userLevel;
                    if (currentQuizType === '1A' && userLevel < 2) { newLevel = 2; alert("¬°Nivel 2 Desbloqueado!"); }
                    if (currentQuizType === '2' && userLevel < 3) newLevel = 3;
                    if (currentQuizType === '3' && userLevel < 4) newLevel = 4;
                    if (currentQuizType === '4') { newLevel = 5; setView('victory'); }
                    
                    setUserLevel(newLevel);
                    setProgress(newProgress);
                    if (user) db.collection("users").doc(user.uid).update({ level: newLevel, progress: newProgress });
                    if (currentQuizType !== '4') setView('mapa_niveles');
                } else {
                    setView('mapa_niveles');
                }
            };

            // --- RENDER ---
            if (loading) return <div className="flex h-screen items-center justify-center text-emerald-600 font-bold">Cargando...</div>;

            if (!user && !showAuth) {
                return (
                    <div className="min-h-screen bg-white flex flex-col animate-in p-6 text-center justify-center">
                        <Icons.Brain />
                        <h1 className="text-4xl font-black text-slate-800 mt-4">Auxiliar<span className="text-emerald-600">Pro</span></h1>
                        <p className="text-slate-500 mb-8">Plataforma de estudio</p>
                        <Button onClick={() => setShowAuth(true)} fullWidth>Ingresar</Button>
                        <p className="text-xs text-gray-400 mt-8">No somos sitio oficial del gobierno.</p>
                    </div>
                );
            }

            if (!user && showAuth) {
                return (
                    <div className="min-h-screen bg-white flex flex-col p-6 justify-center animate-in">
                        <button onClick={() => setShowAuth(false)} className="mb-6 text-slate-500 flex gap-2">‚Üê Volver</button>
                        <h2 className="text-2xl font-bold mb-6 text-center">Acceso</h2>
                        <button onClick={handleGoogle} className="w-full flex justify-center gap-3 border p-3 rounded-xl font-bold text-slate-700 mb-6"><Icons.Google /> Google</button>
                        <LoginBox onLogin={handleLogin} error={errorMsg} />
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-12">
                    <nav className="bg-white border-b sticky top-0 z-50 h-16 flex items-center px-4 justify-between shadow-sm">
                         <div className="flex items-center gap-2"><Icons.Brain /><span className="font-bold text-xl">AuxiliarPro</span></div>
                         <button onClick={handleLogout}><Icons.Simple d={PATHS.logout} className="text-red-500 w-6 h-6" /></button>
                    </nav>
                    <main>
                        {view === 'home' && <HomeView user={user} level={userLevel} setView={setView} />}
                        {view === 'mapa_niveles' && <LevelMap onBack={() => setView('home')} level={userLevel} progress={progress} onTest={(type) => { setCurrentQuizType(type); setView('quiz'); }} />}
                        {view === 'quiz' && <QuizRunner type={currentQuizType} onFinish={handleQuizFinish} onExit={() => setView('mapa_niveles')} />}
                        {view === 'victory' && <Victory onHome={() => setView('home')} />}
                        {view === 'resources' && <Resources onBack={() => setView('home')} />}
                        {view === 'forum' && <Forum user={user} db={db} onBack={() => setView('home')} />}
                        {view === 'faq' && <FAQ onBack={() => setView('home')} />}
                    </main>
                </div>
            );

            // --- SUBCOMPONENTES ---
            function LoginBox({ onLogin, error }) {
                const [email, setEmail] = useState('');
                const [pass, setPass] = useState('');
                const [isReg, setIsReg] = useState(false);
                const [sec, setSec] = useState('');
                return (
                    <div className="space-y-4">
                        <div className="flex items-center gap-2 mb-4"><div className="h-px bg-gray-200 flex-1"></div><span className="text-xs text-gray-400 font-bold">O CORREO</span><div className="h-px bg-gray-200 flex-1"></div></div>
                        <input className="w-full p-3 border rounded-xl" placeholder="Correo" value={email} onChange={e=>setEmail(e.target.value)} />
                        <input className="w-full p-3 border rounded-xl" type="password" placeholder="Contrase√±a" value={pass} onChange={e=>setPass(e.target.value)} />
                        {isReg && <div className="bg-yellow-50 p-3 rounded border border-yellow-200 text-sm">Seguridad: 4 + 3 = ? <input className="w-16 border ml-2 p-1" type="number" value={sec} onChange={e=>setSec(e.target.value)} /></div>}
                        {error && <p className="text-red-500 text-center text-sm">{error}</p>}
                        <Button fullWidth onClick={() => onLogin(email, pass, isReg, sec)}>{isReg ? 'Registrarse' : 'Entrar'}</Button>
                        <p onClick={() => setIsReg(!isReg)} className="text-center text-emerald-600 text-sm font-bold mt-2 cursor-pointer">{isReg ? '¬øTienes cuenta? Entrar' : 'Crear cuenta'}</p>
                    </div>
                );
            }

            function HomeView({ user, level, setView }) {
                return (
                    <div className="p-4 animate-in">
                        <div className="text-center mb-6"><h2 className="text-2xl font-bold">Hola, {user.email.split('@')[0]}</h2></div>
                        <LevelBadgeHeader level={level} />
                        <div className="space-y-4">
                            <button onClick={() => setView('mapa_niveles')} className="w-full bg-emerald-600 text-white p-6 rounded-2xl text-left shadow-lg flex justify-between items-center">
                                <div><h3 className="text-xl font-bold">Zona de Niveles</h3><p className="text-emerald-100 text-sm">Avanza en tu carrera</p></div>
                                <Icons.Simple d={PATHS.arrowRight} />
                            </button>
                            <div className="grid grid-cols-2 gap-4">
                                <button onClick={() => level >= 2 ? setView('resources') : alert("Bloqueado")} className={`p-4 border-2 rounded-2xl text-left ${level >= 2 ? 'bg-white' : 'bg-gray-100 opacity-50'}`}>
                                    <Icons.Simple d={PATHS.book} className="text-blue-600 mb-2" /><div className="font-bold">Biblioteca</div>
                                </button>
                                <button onClick={() => level >= 2 ? setView('forum') : alert("Bloqueado")} className={`p-4 border-2 rounded-2xl text-left ${level >= 2 ? 'bg-white' : 'bg-gray-100 opacity-50'}`}>
                                    <Icons.Simple d={PATHS.msg} className="text-fuchsia-600 mb-2" /><div className="font-bold">Comunidad</div>
                                </button>
                            </div>
                            <button onClick={() => setView('faq')} className="w-full p-3 bg-white border rounded-xl flex justify-center gap-2 font-bold text-slate-600">Preguntas Frecuentes</button>
                        </div>
                    </div>
                );
            }
            
            function LevelMap({ onBack, level, progress, onTest }) {
                return (
                    <div className="p-4 animate-in max-w-md mx-auto">
                        <button onClick={onBack} className="mb-4 text-gray-500">‚Üê Volver</button>
                        <h2 className="text-2xl font-bold mb-6">Mapa de Progreso</h2>
                        <div className="space-y-4 relative">
                             <div className="absolute left-6 top-0 bottom-0 w-0.5 bg-gray-200 -z-10"></div>
                             <div className="bg-white p-4 rounded-xl border-2 border-emerald-500 shadow-sm">
                                <div className="font-bold text-lg mb-2 text-emerald-800">Nivel 1: Diagn√≥stico</div>
                                <Button fullWidth variant={progress['1A'] ? "ghost" : "primary"} onClick={() => onTest('1A')}>{progress['1A'] ? '‚úÖ Aprobado' : 'Rendir Prueba'}</Button>
                             </div>
                             <div className={`bg-white p-4 rounded-xl border-2 ${level >= 2 ? 'border-orange-400' : 'border-gray-200 opacity-70'}`}>
                                <div className="font-bold text-lg mb-2 text-orange-800">Nivel 2: Bronce</div>
                                <Button fullWidth disabled={level < 2} onClick={() => onTest('2')}>{level < 2 ? 'üîí Bloqueado' : 'Rendir Cuestionario'}</Button>
                             </div>
                             <div className={`bg-white p-4 rounded-xl border-2 ${level >= 3 ? 'border-slate-400' : 'border-gray-200 opacity-70'}`}>
                                <div className="font-bold text-lg mb-2 text-slate-800">Nivel 3: Plata</div>
                                <Button fullWidth disabled={level < 3} onClick={() => onTest('3')}>{level < 3 ? 'üîí Bloqueado' : 'Rendir Cuestionario'}</Button>
                             </div>
                             <div className={`bg-white p-4 rounded-xl border-2 ${level >= 4 ? 'border-yellow-400' : 'border-gray-200 opacity-70'}`}>
                                <div className="font-bold text-lg mb-2 text-yellow-800">Nivel 4: Oro</div>
                                <Button fullWidth disabled={level < 4} variant="gold" onClick={() => onTest('4')}>{level < 4 ? 'üîí Bloqueado' : 'EXAMEN FINAL'}</Button>
                             </div>
                        </div>
                    </div>
                )
            }

            function QuizRunner({ type, onFinish, onExit }) {
                const questions = getQuestionsForLevel(type);
                const [i, setI] = useState(0);
                const [score, setScore] = useState(0);
                const [sel, setSel] = useState(null);
                const [showRes, setShowRes] = useState(false);
                
                const confirm = () => {
                    if (sel === questions[i].correcta) setScore(s => s + 1);
                    if (i < questions.length - 1) { setI(i + 1); setSel(null); } 
                    else setShowRes(true);
                };

                if (showRes) {
                    const passed = (score / questions.length) >= 0.7;
                    return (
                        <div className="p-6 text-center animate-in h-screen flex flex-col justify-center">
                            <h2 className="text-3xl font-black mb-2">{passed ? '¬°Aprobado!' : 'No Aprobado'}</h2>
                            <p className="text-xl mb-6">{score} / {questions.length}</p>
                            <Button fullWidth onClick={() => onFinish(passed)}>{passed ? 'Continuar' : 'Volver'}</Button>
                        </div>
                    );
                }

                return (
                    <div className="p-4 animate-in max-w-md mx-auto">
                        <div className="flex justify-between mb-6"><button onClick={onExit}>Salir</button> <span className="font-bold text-emerald-600">{i + 1}/{questions.length}</span></div>
                        <Card className="mb-4">
                            <div className="text-xs font-bold text-gray-400 mb-2 uppercase">{questions[i].cat}</div>
                            <h3 className="text-xl font-bold mb-4">{questions[i].pregunta}</h3>
                            <div className="space-y-2">{questions[i].opciones.map((op, k) => (
                                <button key={k} onClick={() => setSel(k)} className={`w-full p-3 rounded border-2 text-left ${sel === k ? 'border-emerald-500 bg-emerald-50' : 'border-gray-100'}`}>{op}</button>
                            ))}</div>
                        </Card>
                        <Button fullWidth disabled={sel === null} onClick={confirm}>Siguiente</Button>
                    </div>
                );
            }

            function Victory({ onHome }) {
                return <div className="h-screen bg-slate-900 flex flex-col items-center justify-center p-6 text-center text-white"><Icons.Star className="w-20 h-20 text-yellow-400 mb-4"/><h1 className="text-4xl font-black mb-4">¬°LO LOGRASTE!</h1><p className="mb-8">Est√°s listo para la certificaci√≥n.</p><Button variant="gold" onClick={onHome}>Volver al Inicio</Button></div>;
            }

            function Resources({ onBack }) {
                return (
                    <div className="p-4 animate-in max-w-md mx-auto">
                        <button onClick={onBack} className="mb-6 text-gray-500">‚Üê Volver</button>
                        <h2 className="text-2xl font-bold mb-6">Biblioteca</h2>
                        <div className="space-y-6">{BIBLIOTECA_DATA.map((m, i) => (
                            <div key={i} className={`border-l-4 ${m.borde} pl-4`}>
                                <h3 className={`font-bold ${m.color}`}>{m.titulo}</h3>
                                <div className="grid gap-2 mt-2">{m.archivos.map((a, k) => (
                                    <a key={k} href={a.url} target="_blank" className="block p-3 bg-white border rounded-lg shadow-sm hover:bg-gray-50">
                                        <div className="font-bold text-sm">{a.nombre}</div>
                                        <div className="text-xs text-gray-500">{a.desc}</div>
                                    </a>
                                ))}</div>
                            </div>
                        ))}</div>
                    </div>
                );
            }

            function Forum({ user, db, onBack }) {
                const [posts, setPosts] = useState([]);
                const [form, setForm] = useState(false);
                const [t, setT] = useState('');
                const [c, setC] = useState('');

                useEffect(() => db.collection("forum").orderBy("date", "desc").onSnapshot(s => setPosts(s.docs.map(d => ({id: d.id, ...d.data()})))), []);
                const pub = async () => {
                    if(t && c) { await db.collection("forum").add({ title: t, content: c, author: user.email.split('@')[0], date: new Date(), comments: 0 }); setForm(false); setT(''); setC(''); }
                };

                return (
                    <div className="p-4 animate-in max-w-md mx-auto">
                        <button onClick={onBack} className="mb-4 text-gray-500">‚Üê Volver</button>
                        <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">Foro</h2><button onClick={() => setForm(true)} className="text-sm bg-emerald-100 text-emerald-700 px-3 py-1 rounded">Nuevo</button></div>
                        {form ? <div className="space-y-3"><input className="w-full border p-2 rounded" placeholder="T√≠tulo" value={t} onChange={e=>setT(e.target.value)} /><textarea className="w-full border p-2 rounded h-24" placeholder="Texto" value={c} onChange={e=>setC(e.target.value)} /><Button fullWidth onClick={pub}>Publicar</Button></div> :
                        <div className="space-y-3">{posts.map(p => <div key={p.id} className="bg-white p-4 rounded-xl border shadow-sm"><h4 className="font-bold">{p.title}</h4><p className="text-sm text-gray-600">{p.content}</p><div className="text-xs text-gray-400 mt-2">Por {p.author}</div></div>)}</div>}
                    </div>
                )
            }

            function FAQ({ onBack }) {
                return <div className="p-4 animate-in max-w-md mx-auto"><button onClick={onBack} className="mb-6">‚Üê Volver</button><h2 className="text-2xl font-bold mb-4">Preguntas Frecuentes</h2><div className="space-y-4"><div className="p-4 bg-white border rounded-xl"><h3 className="font-bold text-emerald-700">¬øCu√°ndo son las pruebas?</h3><p className="text-sm">Marzo y Octubre generalmente. Revisa SEREMI en l√≠nea.</p></div></div></div>;
            }
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
